<!DOCTYPE html>
<html>

<head>
    <title>Create Postings</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="../css/project.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script>
    <script src="../js/create-postings.js"></script>


    <!-- Links for the Date Picker -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

    <!-- Links for Firebase -->
    <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>    
    <script src="https://cdn.firebase.com/libs/firebaseui/3.1.1/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.1.1/firebaseui.css" />

</head>

<body>
    <script src="../js/load-firebase.js"></script>
    <div class="grid">

        <!-- HEADER -->
        <header class="header">
            <img src="../img/logo.png" id="logo" />
            <h1 id="name">
                <a href="./index.html"> VolunteerGo</a>
            </h1>
            <button id="sign-out" class="account">SIGN OUT</button>
        </header>

        <!-- NAVBAR -->
        <nav class="navbar">
            <ul>
                <li id="active"><a href="./index.html">Home</a></li>
                <li><a href="#">About Us</a></li>
                <li><a href="#">Volunteers</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
            <div id="search-container">
                <form action="">
                    <input type="text" placeholder="Search.." name="search">
                    <button type="submit"><i class="fa fa-search"></i></button>
                </form>
            </div>
        </nav>

        <!-- SIDE BAR --->
        <aside class="sidebar">
            <ul id="postings-nav"><span id="sidenav-headings">Postings</span>
                <li><a href="./create_postings.html">Create</a></li>
                <li><a href="./view_postings.html">View Posts</a></li>
                <li><a href="#">Drafts</a></li>
            </ul>
            <ul id="mail-nav"><span id="sidenav-headings">Mail</span>
                <li><a href="#">Inbox</a></li>
                <li><a href="#">Create</a></li>
            </ul>
            <ul id="settings-nav"><span id="sidenav-headings">Settings</span>
                <li><a href="#">Account</a></li>
                <li><a href="#">Privacy</a></li>
            </ul>
        </aside>

        <!-- CONTENT -->
        <article class="content">
            <form id="post-creation-form" action="" method="post">

                <label for="title">Title </label>
                <br>
                <input type="text" id="title" name="title" value="" required="required" placeholder="" />

                <!-- Event Duration Buttons -->
                <br>
                <label>Choose event duration</label>
                <br>
                <label>One time <input type="radio" name="date-duration" id="one-time" value="onetime" onclick="showDateSelection();" />
                </label>
                <label>Continuous <input type="radio" name="date-duration" id="continuous" value="continuous" onclick="showContinuousSelection();" />
                </label>

                <!-- When One time is selected -->
                <div class="hidden-unless-selected" id="one-time-div">
                    Pick a date
                    <br>

                    <!-- Single Date Picker -->
                    <input type="text" id="date" name="date" value="11/24/1984" />
                    <script>
                        $(function () {
                            $('input[name="date"]').daterangepicker({
                                singleDatePicker: true,
                                showDropdowns: true,
                                minYear: 1901,
                                maxYear: parseInt(moment().format('YYYY'), 10)
                            }, function (start, end, label) {
                                console.log("A new date selection was made: " + start.format('YYYY-MM-DD'));
                            });
                        });
                    </script>
                </div>

                <!-- When "Continuous" is selected -->
                <div class="hidden-unless-selected" id="continuous-div">
                    Pick a date range
                    <br>

                    <!-- Date range picker -->
                    <input type="text" id="daterange" name="daterange" value="01/01/2018 - 11/24/2018" />
                    <script>
                        $(function () {
                            $('input[name="daterange"]').daterangepicker({
                                opens: 'left'
                            }, function (start, end, label) {
                                console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
                            });
                        });
                    </script>
                </div>

                <!--Location and Description fields-->
                <br>
                <label for="location">Location </label> <br>
                <input type="text" id="location" name="location" value="" required="required" placeholder="" />


                <br>
                <label for="description">Description </label><br>
                <input type="text" id="description" name="description" value="" required="required" placeholder="" />

                <!-- Skills Description fields -->
                <br>
                <label>Is this a skilled position? </label> <br>
                <label>Yes <input type="radio" name="skilled-choice" id="skilled-yes" value="yes" onclick="showSkillsDescription();" />
                </label>
                <label>No <input type="radio" name="skilled-choice" id="skilled-no" value="no" onclick="hideSkillsDescription();" />
                </label>

                <!--When user selects Yes-->
                <div class="hidden-unless-selected" id="skill-choice-yes">
                    <label for="skill-description">Skills required </label>
                    <br>
                    <input type="text" id="skill-description" name="skill-description" value="" placeholder="" />
                </div>

                <!--Filter tags field-->
                <div id="tags">
                    <label for="filter-tags">Filters / Tags</label>
                    <br>
                    <input type="text" id="filter-tags" name="filter-tags" value="" required="required" placeholder="" />
                </div>

                <!-- Submit button -->
                <input type="submit" />
            </form>

            <!-- Writing stuff to the database -->
            <script>
                document.getElementById('post-creation-form').addEventListener('submit', submitForm);

                function submitForm(e) {
                    e.preventDefault();
                    var title = document.getElementById("title").value;
                    //console.log(title);
                    var dateOneTime = document.getElementById("date").value;
                    var dateContinuous = document.getElementById("daterange").value
  
                    // checking which version of date to put
                    // if continuous date is picked
                    if (dateOneTime === null) {
                        var dates = document.getElementById("daterange").value;
                    }
                    else {
                        var dates = document.getElementById("date").value;
                    }
                    //console.log(dates);

                    var location = document.getElementById("location").value;
                    var description = document.getElementById("description").value;
                    //console.log(location);
                    //console.log(description);
                    
                    // Checking if user requires skilled volunteers
                    // if yes, add skill description to post
                    var skilledChoiceNo = document.getElementById("skilled-no").value;
                    if (skilledChoiceNo == null) {
                        var skillDescription = document.getElementById("daterange").value;
                        console.log(skillDescription);
                    }
                    var filterTags = document.getElementById("filter-tags").value;

                    // Putting all the data into firebase
                    var firebase = app_firebase;
                    firebase.auth().onAuthStateChanged(function(user){
                        console.log(title);
                        console.log(dates);
                        console.log(location);
                        console.log(description);
                        console.log(skillDescription);

                        var dbActivePosts = firebase.database().ref('activePosts');
                        var lastPostId;
                        dbActivePosts.once('value', function(snapshot) {
                            snapshot.forEach(function(currentPostId) {
                                lastPostId = currentPostId;
                                console.log(currentPostId);
                            });
                        });

                        // creating a new Post ID
                        var newPostId = (parseInt(lastPostId, 10) + 1).toString();
                        firebase.database().ref('activePosts').update( {
                            newPostId : {
                                "title": title,
                                "dates": dates,
                                "location": location,
                                "description": description,
                                "skill-desctiption": skillDescription
                            }
                        });
                    });
                    window.alert("Your post has been successfully created!");
                    window.location.href = "landing.html";                 
                }
            </script>
        </article>

    </div>

    <!-- JAVASCRIPT -->
    <script type="text/javascript">
        document.getElementById("sign-out").onclick = function () {
            firebase.auth().signOut()
            location.href = "./index.html";
        };
    </script>

</body>

</html>